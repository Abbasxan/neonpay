

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; NEONPAY 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title=")" href="FAQ.html" />
    <link rel="prev" title="NEONPAY Documentation (English)" href="README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            NEONPAY
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Language Selection:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">NEONPAY Documentation (English)</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ru/index.html">Документация NEONPAY (Русский)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ru/index.html#id4">Индексы и таблицы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../az/index.html">NEONPAY Sənədləri (Azərbaycan)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../az/index.html#indekslr-v-cdvllr">İndekslər və Cədvəllər</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">NEONPAY Documentation (English)</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">)</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html#id98">)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Documentation Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NEONPAY</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">NEONPAY Documentation (English)</a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/en/API.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p># NEONPAY API Reference</p>
<p>Complete API documentation for NEONPAY library.</p>
<p>## Quick Start</p>
<p>### Factory Function</p>
<p>```python
from neonpay.factory import create_neonpay</p>
<p># Automatic adapter detection
neonpay = create_neonpay(bot_instance=your_bot_instance)
```</p>
<p><strong>Parameters:</strong>
- <cite>bot_instance</cite>: Your bot instance (Bot, Client, TeleBot, etc.)
- <cite>dispatcher</cite>: Dispatcher instance (for Aiogram)
- <cite>thank_you_message</cite>: Custom thank you message</p>
<p><strong>Returns:</strong> Configured NeonPayCore instance</p>
<p>## Core Classes</p>
<p>### NeonPayCore</p>
<p>Main payment processing class.</p>
<p>```python
class NeonPayCore:</p>
<blockquote>
<div><p>def __init__(self, adapter: PaymentAdapter, thank_you_message: str = “Thank you for your payment!”)</p>
</div></blockquote>
<p>```</p>
<p>#### Methods</p>
<p>##### <cite>async setup() -&gt; None</cite>
Initialize the payment system. Called automatically when needed.</p>
<p>##### <cite>create_payment_stage(stage_id: str, stage: PaymentStage) -&gt; None</cite>
Create a new payment stage.</p>
<p><strong>Parameters:</strong>
- <cite>stage_id</cite>: Unique identifier for the payment stage
- <cite>stage</cite>: PaymentStage configuration object</p>
<p><strong>Raises:</strong>
- <cite>ValidationError</cite>: If stage_id already exists or stage is invalid</p>
<p>##### <cite>get_payment_stage(stage_id: str) -&gt; Optional[PaymentStage]</cite>
Retrieve a payment stage by ID.</p>
<p><strong>Returns:</strong> PaymentStage object or None if not found</p>
<p>##### <cite>list_payment_stages() -&gt; Dict[str, PaymentStage]</cite>
Get all payment stages.</p>
<p><strong>Returns:</strong> Dictionary mapping stage IDs to PaymentStage objects</p>
<p>##### <cite>remove_payment_stage(stage_id: str) -&gt; bool</cite>
Remove a payment stage.</p>
<p><strong>Returns:</strong> True if stage was removed, False if not found</p>
<p>##### <cite>async send_payment(user_id: int, stage_id: str) -&gt; bool</cite>
Send payment invoice to user.</p>
<p><strong>Parameters:</strong>
- <cite>user_id</cite>: Telegram user ID
- <cite>stage_id</cite>: Payment stage identifier</p>
<p><strong>Returns:</strong> True if invoice sent successfully</p>
<p><strong>Raises:</strong>
- <cite>PaymentError</cite>: If stage not found or sending fails</p>
<p>##### <cite>on_payment(callback: Callable[[PaymentResult], None]) -&gt; None</cite>
Register payment completion callback.</p>
<p><strong>Parameters:</strong>
- <cite>callback</cite>: Function to call when payment completes</p>
<p>##### <cite>get_stats() -&gt; Dict[str, Any]</cite>
Get payment system statistics.</p>
<p><strong>Returns:</strong> Dictionary with system information</p>
<p>### PaymentStage</p>
<p>Payment configuration class.</p>
<p>```python
&#64;dataclass
class PaymentStage:</p>
<blockquote>
<div><p>title: str
description: str
price: int
label: str = “Payment”
photo_url: Optional[str] = None
payload: Optional[Dict[str, Any]] = field(default_factory=dict)
provider_token: str = “”
start_parameter: str = “neonpay”</p>
</div></blockquote>
<p>```</p>
<p><strong>Validation:</strong>
- <cite>price</cite> must be positive
- <cite>title</cite> and <cite>description</cite> cannot be empty</p>
<p>### PaymentResult</p>
<p>Payment completion result.</p>
<p>```python
&#64;dataclass
class PaymentResult:</p>
<blockquote>
<div><p>user_id: int
amount: int
currency: str = “XTR”
status: PaymentStatus = PaymentStatus.COMPLETED
stage: Optional[PaymentStage] = None
transaction_id: Optional[str] = None
timestamp: Optional[float] = None
metadata: Dict[str, Any] = field(default_factory=dict)</p>
</div></blockquote>
<p>```</p>
<p>### PaymentStatus</p>
<p>Payment status enumeration.</p>
<p>```python
class PaymentStatus(Enum):</p>
<blockquote>
<div><p>PENDING = “pending”
COMPLETED = “completed”
CANCELLED = “cancelled”
FAILED = “failed”
REFUNDED = “refunded”</p>
</div></blockquote>
<p>```</p>
<p>## Adapters</p>
<p>### PaymentAdapter</p>
<p>Abstract base class for bot library adapters.</p>
<p>```python
class PaymentAdapter(ABC):</p>
<blockquote>
<div><p>&#64;abstractmethod
async def send_invoice(self, user_id: int, stage: PaymentStage) -&gt; bool</p>
<p>&#64;abstractmethod
async def setup_handlers(self, payment_callback: Callable[[PaymentResult], None]) -&gt; None</p>
<p>&#64;abstractmethod
def get_library_info(self) -&gt; Dict[str, str]</p>
</div></blockquote>
<p>```</p>
<p>### PyrogramAdapter</p>
<p>Pyrogram library adapter.</p>
<p>```python
class PyrogramAdapter(PaymentAdapter):</p>
<blockquote>
<div><p>def __init__(self, app: Client)</p>
</div></blockquote>
<p>```</p>
<p>### AiogramAdapter</p>
<p>Aiogram library adapter.</p>
<p>```python
class AiogramAdapter(PaymentAdapter):</p>
<blockquote>
<div><p>def __init__(self, bot: Bot, dispatcher: Optional[Dispatcher] = None)</p>
</div></blockquote>
<p>```</p>
<p>### PythonTelegramBotAdapter</p>
<p>python-telegram-bot library adapter.</p>
<p>```python
class PythonTelegramBotAdapter(PaymentAdapter):</p>
<blockquote>
<div><p>def __init__(self, application: Application)</p>
</div></blockquote>
<p>```</p>
<p>### TelebotAdapter</p>
<p>pyTelegramBotAPI library adapter.</p>
<p>```python
class TelebotAdapter(PaymentAdapter):</p>
<blockquote>
<div><p>def __init__(self, bot: TeleBot)</p>
</div></blockquote>
<p>```</p>
<p>### RawAPIAdapter</p>
<p>Raw Telegram Bot API adapter.</p>
<p>```python
class RawAPIAdapter(PaymentAdapter):</p>
<blockquote>
<div><p>def __init__(self, bot_token: str, webhook_url: Optional[str] = None)</p>
<p>async def handle_webhook_update(self, update_data: Dict[str, Any])
async def close()</p>
</div></blockquote>
<p>```</p>
<p>## Factory Functions</p>
<p>### create_neonpay</p>
<p>Convenience function for automatic adapter creation.</p>
<p>```python
def create_neonpay(</p>
<blockquote>
<div><p>bot_instance: Any,
thank_you_message: str = “Thank you for your payment!”</p>
</div></blockquote>
<p>) -&gt; NeonPayCore
```</p>
<p><strong>Parameters:</strong>
- <cite>bot_instance</cite>: Bot instance from any supported library
- <cite>thank_you_message</cite>: Thank you message for payments</p>
<p><strong>Returns:</strong> Configured NeonPayCore instance</p>
<p><strong>Raises:</strong>
- <cite>ConfigurationError</cite>: If bot library is not supported</p>
<p>### AdapterFactory.create_adapter</p>
<p>Create appropriate adapter for bot instance.</p>
<p>```python
&#64;staticmethod
def create_adapter(bot_instance: Any) -&gt; PaymentAdapter
```</p>
<p>## Error Classes</p>
<p>### NeonPayError</p>
<p>Base exception class.</p>
<p>```python
class NeonPayError(Exception):</p>
<blockquote>
<div><p>pass</p>
</div></blockquote>
<p>```</p>
<p>### PaymentError</p>
<p>Payment processing error.</p>
<p>```python
class PaymentError(NeonPayError):</p>
<blockquote>
<div><p>pass</p>
</div></blockquote>
<p>```</p>
<p>### ConfigurationError</p>
<p>Configuration or setup error.</p>
<p>```python
class ConfigurationError(NeonPayError):</p>
<blockquote>
<div><p>pass</p>
</div></blockquote>
<p>```</p>
<p>### AdapterError</p>
<p>Bot library adapter error.</p>
<p>```python
class AdapterError(NeonPayError):</p>
<blockquote>
<div><p>pass</p>
</div></blockquote>
<p>```</p>
<p>### ValidationError</p>
<p>Data validation error.</p>
<p>```python
class ValidationError(NeonPayError):</p>
<blockquote>
<div><p>pass</p>
</div></blockquote>
<p>```</p>
<p>## Usage Examples</p>
<p>### Basic Usage</p>
<p>```python
from neonpay import create_neonpay, PaymentStage</p>
<p># Initialize
neonpay = create_neonpay(bot)</p>
<p># Create stage
stage = PaymentStage(“Product”, “Description”, 100)
neonpay.create_payment_stage(“product1”, stage)</p>
<p># Send payment
await neonpay.send_payment(user_id, “product1”)</p>
<p># Handle payments
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><p>print(f”Payment: {result.amount} from {result.user_id}”)</p>
</div></blockquote>
<p>```</p>
<p>### Advanced Usage</p>
<p>```python
from neonpay import NeonPayCore, PyrogramAdapter, PaymentStage, PaymentStatus</p>
<p># Manual adapter creation
adapter = PyrogramAdapter(pyrogram_client)
neonpay = NeonPayCore(adapter, “Thanks for your purchase!”)</p>
<p># Complex payment stage
stage = PaymentStage(</p>
<blockquote>
<div><p>title=”Premium Subscription”,
description=”Monthly premium access”,
price=500,
label=”Subscribe Now”,
photo_url=”<a class="reference external" href="https://example.com/premium.png">https://example.com/premium.png</a>”,
payload={“plan”: “premium”, “duration”: “monthly”},
start_parameter=”premium_ref”</p>
</div></blockquote>
<p>)</p>
<p>neonpay.create_payment_stage(“premium_monthly”, stage)</p>
<p># Advanced payment handling
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><dl>
<dt>if result.status == PaymentStatus.COMPLETED:</dt><dd><p>plan = result.metadata.get(“plan”)
duration = result.metadata.get(“duration”)</p>
<p># Business logic
await activate_subscription(result.user_id, plan, duration)</p>
<p># Send confirmation
await send_confirmation(result.user_id, result.amount)</p>
</dd>
</dl>
</div></blockquote>
<p>```</p>
<p>### Error Handling</p>
<p>```python
from neonpay import NeonPayError, PaymentError, ValidationError</p>
<dl class="simple">
<dt>try:</dt><dd><p># Create stage with validation
stage = PaymentStage(“”, “Description”, -100)  # Invalid
neonpay.create_payment_stage(“invalid”, stage)</p>
</dd>
<dt>except ValidationError as e:</dt><dd><p>print(f”Validation error: {e}”)</p>
</dd>
<dt>try:</dt><dd><p># Send payment
await neonpay.send_payment(user_id, “nonexistent”)</p>
</dd>
<dt>except PaymentError as e:</dt><dd><p>print(f”Payment error: {e}”)</p>
</dd>
<dt>except NeonPayError as e:</dt><dd><p>print(f”General error: {e}”)</p>
</dd>
</dl>
<p>```</p>
<p>—</p>
<p>[← Back to Documentation](README.md)</p>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="README.html" class="btn btn-neutral float-left" title="NEONPAY Documentation (English)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FAQ.html" class="btn btn-neutral float-right" title=")" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, NEONPAY Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>