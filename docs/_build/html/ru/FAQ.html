

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>) &mdash; NEONPAY 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="SECURITY.html" />
    <link rel="prev" title="&lt;no title&gt;" href="API.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            NEONPAY
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Language Selection:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../en/index.html">NEONPAY Documentation (English)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../en/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Документация NEONPAY (Русский)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Документация NEONPAY (Русский)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id98">)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Возможности</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Быстрый старт</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Поддерживаемые языки</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#id4">Индексы и таблицы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../az/index.html">NEONPAY Sənədləri (Azərbaycan)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../az/index.html#indekslr-v-cdvllr">İndekslər və Cədvəllər</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../en/README.html">NEONPAY Documentation (English)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../en/FAQ.html">)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../en/FAQ.html#id98">)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Documentation Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NEONPAY</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Документация NEONPAY (Русский)</a></li>
      <li class="breadcrumb-item active">)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ru/FAQ.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p># Часто задаваемые вопросы (FAQ) - NEONPAY</p>
<p>Частые вопросы и ответы о библиотеке NEONPAY.</p>
<p>## Содержание</p>
<ol class="arabic simple">
<li><p>[Общие вопросы](#общие-вопросы)</p></li>
<li><p>[Установка и настройка](#установка-и-настройка)</p></li>
<li><p>[Обработка платежей](#обработка-платежей)</p></li>
<li><p>[Обработка ошибок](#обработка-ошибок)</p></li>
<li><p>[Безопасность](#безопасность)</p></li>
<li><p>[Продакшн развертывание](#продакшн-развертывание)</p></li>
<li><p>[Решение проблем](#решение-проблем)</p></li>
</ol>
<p>## Общие вопросы</p>
<p>### Что такое NEONPAY?</p>
<p>NEONPAY - это Python библиотека, которая упрощает интеграцию платежей Telegram Stars для разработчиков ботов. Она предоставляет единый API для множества библиотек ботов (Aiogram, Pyrogram, pyTelegramBotAPI и др.) и автоматически обрабатывает платежи.</p>
<p>### Какие библиотеки ботов поддерживаются?</p>
<p>NEONPAY поддерживает:
- <strong>Aiogram</strong> (Рекомендуется) - Современная асинхронная библиотека
- <strong>Pyrogram</strong> - Популярная MTProto библиотека
- <strong>pyTelegramBotAPI</strong> - Простая синхронная библиотека
- <strong>python-telegram-bot</strong> - Комплексная библиотека
- <strong>Raw Telegram Bot API</strong> - Прямые HTTP запросы</p>
<p>### Что такое Telegram Stars?</p>
<p>Telegram Stars - это встроенная виртуальная валюта Telegram, которую пользователи могут покупать и использовать для оплаты цифровых товаров и услуг в ботах. Она официально поддерживается Telegram и обеспечивает бесшовный опыт платежей.</p>
<p>### Бесплатно ли использовать NEONPAY?</p>
<p>Да, NEONPAY полностью бесплатна и с открытым исходным кодом. Вы платите только комиссию Telegram за обработку платежей Stars (обычно 5% от суммы транзакции).</p>
<p>## Установка и настройка</p>
<p>### Как установить NEONPAY?</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>bash
# Базовая установка
pip install neonpay</p>
<p># С конкретной библиотекой бота
pip install neonpay aiogram  # Для Aiogram
pip install neonpay pyrogram  # Для Pyrogram
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>### Как быстро начать?</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>python
from neonpay.factory import create_neonpay
from neonpay.core import PaymentStage, PaymentStatus</p>
<p># Инициализация
neonpay = create_neonpay(bot_instance=ваш_бот)</p>
<p># Создание этапа платежа
stage = PaymentStage(</p>
<blockquote>
<div><p>title=”Премиум доступ”,
description=”Разблокировать премиум функции”,
price=25,  # 25 Telegram Stars</p>
</div></blockquote>
<p>)
neonpay.create_payment_stage(“premium”, stage)</p>
<p># Обработка платежей
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><dl class="simple">
<dt>if result.status == PaymentStatus.COMPLETED:</dt><dd><p>print(f”Платеж получен: {result.amount} звезд”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>### Нужно ли настраивать webhook?</p>
<p>Нет, NEONPAY автоматически обрабатывает конфигурацию webhook для поддерживаемых библиотек. Для Raw API вам нужно настроить webhook вручную.</p>
<p>### Как выбрать правильную библиотеку бота?</p>
<p><strong>Для новых проектов:</strong> Используйте <strong>Aiogram</strong> - она современная, хорошо документирована и имеет отличную поддержку async.</p>
<p><strong>Для существующих проектов:</strong> Используйте любую библиотеку, которую вы уже используете. NEONPAY работает со всеми основными библиотеками.</p>
<p>## Обработка платежей</p>
<p>### Как создать разные варианты платежей?</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>python
# Варианты донатов
donation_stages = [</p>
<blockquote>
<div><p>PaymentStage(“Поддержка 1⭐”, “Помочь боту работать”, 1),
PaymentStage(“Поддержка 10⭐”, “Поддержать разработку”, 10),
PaymentStage(“Поддержка 50⭐”, “Большая поддержка”, 50),</p>
</div></blockquote>
<p>]</p>
<p># Цифровые продукты
product_stages = [</p>
<blockquote>
<div><p>PaymentStage(“Премиум доступ”, “30 дней премиум”, 25),
PaymentStage(“Кастомная тема”, “Персонализированная тема”, 15),</p>
</div></blockquote>
<p>]</p>
<p># Добавить все этапы
for i, stage in enumerate(donation_stages):</p>
<blockquote>
<div><p>neonpay.create_payment_stage(f”donate_{i}”, stage)</p>
</div></blockquote>
<dl class="simple">
<dt>for i, stage in enumerate(product_stages):</dt><dd><p>neonpay.create_payment_stage(f”product_{i}”, stage)</p>
</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a></p>
<p>### Как обрабатывать разные типы платежей?</p>
<p><a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>python
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><dl class="simple">
<dt>if result.status == PaymentStatus.COMPLETED:</dt><dd><dl class="simple">
<dt>if result.stage_id.startswith(”<a href="#id175"><span class="problematic" id="id176">donate_</span></a>”):</dt><dd><p># Обработать донат
await handle_donation(result)</p>
</dd>
<dt>elif result.stage_id.startswith(”<a href="#id177"><span class="problematic" id="id178">product_</span></a>”):</dt><dd><p># Обработать покупку продукта
await handle_product_purchase(result)</p>
</dd>
<dt>else:</dt><dd><p># Обработать другие платежи
await handle_other_payment(result)</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>### Можно ли настроить сообщения о платежах?</p>
<p>Да, вы можете настроить сообщение благодарности:</p>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>python
neonpay = create_neonpay(</p>
<blockquote>
<div><p>bot_instance=bot,
thank_you_message=”🎉 Спасибо за покупку! Ваш продукт теперь активен.”</p>
</div></blockquote>
<section id="id37">
<h1>)<a class="headerlink" href="#id37" title="Link to this heading"></a></h1>
<p>### Как валидировать суммы платежей?</p>
<p><a href="#id38"><span class="problematic" id="id39">``</span></a><a href="#id40"><span class="problematic" id="id41">`</span></a>python
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><p># Получить ожидаемую сумму для этого этапа
stage = neonpay.get_payment_stage(result.stage_id)
expected_amount = stage.price</p>
<dl class="simple">
<dt>if result.amount != expected_amount:</dt><dd><p>logger.warning(f”Несоответствие суммы: ожидалось {expected_amount}, получено {result.amount}”)
return</p>
</dd>
</dl>
<p># Обработать платеж
await process_payment(result)</p>
</div></blockquote>
<p><a href="#id42"><span class="problematic" id="id43">``</span></a><a href="#id44"><span class="problematic" id="id45">`</span></a></p>
<p>## Обработка ошибок</p>
<p>### Что происходит, если платеж не удался?</p>
<p>NEONPAY автоматически обрабатывает неудачные платежи и предоставляет подробную информацию об ошибках:</p>
<p><a href="#id46"><span class="problematic" id="id47">``</span></a><a href="#id48"><span class="problematic" id="id49">`</span></a>python
&#64;neonpay.on_payment
async def handle_payment(result):</p>
<blockquote>
<div><dl class="simple">
<dt>if result.status == PaymentStatus.COMPLETED:</dt><dd><p># Платеж успешен
await process_successful_payment(result)</p>
</dd>
<dt>elif result.status == PaymentStatus.FAILED:</dt><dd><p># Платеж не удался
await handle_payment_failure(result)</p>
</dd>
<dt>elif result.status == PaymentStatus.PENDING:</dt><dd><p># Платеж в ожидании
await handle_pending_payment(result)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id50"><span class="problematic" id="id51">``</span></a><a href="#id52"><span class="problematic" id="id53">`</span></a></p>
<p>### Как обрабатывать сетевые ошибки?</p>
<p><a href="#id54"><span class="problematic" id="id55">``</span></a><a href="#id56"><span class="problematic" id="id57">`</span></a>python
async def safe_send_payment(user_id: int, stage_id: str):</p>
<blockquote>
<div><dl class="simple">
<dt>try:</dt><dd><p>await neonpay.send_payment(user_id, stage_id)</p>
</dd>
<dt>except PaymentError as e:</dt><dd><p>logger.error(f”Ошибка платежа: {e}”)
await bot.send_message(user_id, “Платеж не удался. Попробуйте еще раз.”)</p>
</dd>
<dt>except Exception as e:</dt><dd><p>logger.error(f”Неожиданная ошибка: {e}”)
await bot.send_message(user_id, “Что-то пошло не так. Попробуйте позже.”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id58"><span class="problematic" id="id59">``</span></a><a href="#id60"><span class="problematic" id="id61">`</span></a></p>
<p>### Что если токен бота недействителен?</p>
<p>NEONPAY вызовет <cite>ConfigurationError</cite>, если токен бота недействителен:</p>
<p><a href="#id62"><span class="problematic" id="id63">``</span></a><a href="#id64"><span class="problematic" id="id65">`</span></a>python
try:</p>
<blockquote>
<div><p>neonpay = create_neonpay(bot_instance=bot)</p>
</div></blockquote>
<dl class="simple">
<dt>except ConfigurationError as e:</dt><dd><p>print(f”Ошибка конфигурации: {e}”)
# Проверьте ваш токен бота</p>
</dd>
</dl>
<p><a href="#id66"><span class="problematic" id="id67">``</span></a><a href="#id68"><span class="problematic" id="id69">`</span></a></p>
<p>## Безопасность</p>
<p>### Как защитить токен бота?</p>
<p>Никогда не хардкодите токены в исходном коде:</p>
<p><a href="#id70"><span class="problematic" id="id71">``</span></a><a href="#id72"><span class="problematic" id="id73">`</span></a>python
# ❌ Неправильно
BOT_TOKEN = “1234567890:ABCdefGHIjklMNOpqrsTUVwxyz”</p>
<p># ✅ Правильно
import os
BOT_TOKEN = os.getenv(“BOT_TOKEN”)
<a href="#id74"><span class="problematic" id="id75">``</span></a><a href="#id76"><span class="problematic" id="id77">`</span></a></p>
<p>### Как валидировать права пользователей?</p>
<p><a href="#id78"><span class="problematic" id="id79">``</span></a><a href="#id80"><span class="problematic" id="id81">`</span></a>python
async def safe_send_payment(user_id: int, stage_id: str):</p>
<blockquote>
<div><p># Проверить, может ли пользователь делать платежи
if not await user_can_pay(user_id):</p>
<blockquote>
<div><p>await bot.send_message(user_id, “У вас нет прав на совершение платежей.”)
return</p>
</div></blockquote>
<p># Проверить, достиг ли пользователь лимита платежей
if await user_payment_limit_reached(user_id):</p>
<blockquote>
<div><p>await bot.send_message(user_id, “Вы достигли лимита платежей.”)
return</p>
</div></blockquote>
<p># Отправить платеж
await neonpay.send_payment(user_id, stage_id)</p>
</div></blockquote>
<p><a href="#id82"><span class="problematic" id="id83">``</span></a><a href="#id84"><span class="problematic" id="id85">`</span></a></p>
<p>### Как предотвратить мошенничество с платежами?</p>
<p><a href="#id86"><span class="problematic" id="id87">``</span></a><a href="#id88"><span class="problematic" id="id89">`</span></a>python
class PaymentValidator:</p>
<blockquote>
<div><dl>
<dt>def __init__(self):</dt><dd><p>self.user_payments = defaultdict(list)
self.max_payments_per_hour = 5</p>
</dd>
<dt>async def validate_payment(self, user_id: int, stage_id: str) -&gt; bool:</dt><dd><p># Проверить частоту платежей
now = time.time()
recent_payments = [</p>
<blockquote>
<div><p>t for t in self.user_payments[user_id]
if now - t &lt; 3600  # Последний час</p>
</div></blockquote>
<p>]</p>
<dl class="simple">
<dt>if len(recent_payments) &gt;= self.max_payments_per_hour:</dt><dd><p>return False</p>
</dd>
</dl>
<p># Проверить на подозрительные паттерны
if await self.is_suspicious_user(user_id):</p>
<blockquote>
<div><p>return False</p>
</div></blockquote>
<p>return True</p>
</dd>
<dt>async def record_payment(self, user_id: int):</dt><dd><p>self.user_payments[user_id].append(time.time())</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id90"><span class="problematic" id="id91">``</span></a><a href="#id92"><span class="problematic" id="id93">`</span></a></p>
<p>## Продакшн развертывание</p>
<p>### Как развернуть в продакшн?</p>
<p>1. <strong>Используйте переменные окружения:</strong>
<code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">import</span> <span class="pre">os</span>
<span class="pre">BOT_TOKEN</span> <span class="pre">=</span> <span class="pre">os.getenv(&quot;BOT_TOKEN&quot;)</span>
<span class="pre">DATABASE_URL</span> <span class="pre">=</span> <span class="pre">os.getenv(&quot;DATABASE_URL&quot;)</span>
<span class="pre">`</span></code></p>
<p>2. <strong>Настройте правильное логирование:</strong>
<a href="#id94"><span class="problematic" id="id95">``</span></a><a href="#id96"><span class="problematic" id="id97">`</span></a>python
import logging
logging.basicConfig(</p>
<blockquote>
<div><p>level=logging.INFO,
format=”%(asctime)s - %(name)s - %(levelname)s - %(message)s”</p>
</div></blockquote>
</section>
<section id="id98">
<h1>)<a class="headerlink" href="#id98" title="Link to this heading"></a></h1>
<p>3. <strong>Используйте продакшн базу данных:</strong>
<a href="#id99"><span class="problematic" id="id100">``</span></a><a href="#id101"><span class="problematic" id="id102">`</span></a>python
# Замените хранилище в памяти на базу данных
import asyncpg</p>
<dl>
<dt>async def store_payment(payment_data):</dt><dd><p>conn = await asyncpg.connect(DATABASE_URL)
await conn.execute(</p>
<blockquote>
<div><p>“INSERT INTO payments (user_id, amount, stage_id, created_at) VALUES ($1, $2, $3, NOW())”,
payment_data[‘user_id’], payment_data[‘amount’], payment_data[‘stage_id’]</p>
</div></blockquote>
<p>)
await conn.close()</p>
</dd>
</dl>
<p><a href="#id103"><span class="problematic" id="id104">``</span></a><a href="#id105"><span class="problematic" id="id106">`</span></a></p>
<p>### Как мониторить платежи?</p>
<p><a href="#id107"><span class="problematic" id="id108">``</span></a><a href="#id109"><span class="problematic" id="id110">`</span></a>python
class PaymentMonitor:</p>
<blockquote>
<div><dl>
<dt>def __init__(self):</dt><dd><p>self.payment_stats = defaultdict(int)</p>
</dd>
<dt>async def log_payment(self, result):</dt><dd><p>self.payment_stats[‘total_payments’] += 1
self.payment_stats[‘total_amount’] += result.amount</p>
<p># Логировать в базу данных
await self.store_payment_log(result)</p>
<p># Отправлять оповещения при высоком объеме
if self.payment_stats[‘total_payments’] % 100 == 0:</p>
<blockquote>
<div><p>await self.send_volume_alert()</p>
</div></blockquote>
</dd>
<dt>async def get_stats(self):</dt><dd><p>return dict(self.payment_stats)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id111"><span class="problematic" id="id112">``</span></a><a href="#id113"><span class="problematic" id="id114">`</span></a></p>
<p>### Как обрабатывать высокий трафик?</p>
<p><a href="#id115"><span class="problematic" id="id116">``</span></a><a href="#id117"><span class="problematic" id="id118">`</span></a>python
# Используйте пул соединений
import asyncpg</p>
<dl>
<dt>class DatabasePool:</dt><dd><dl>
<dt>def __init__(self, database_url: str):</dt><dd><p>self.pool = None
self.database_url = database_url</p>
</dd>
<dt>async def initialize(self):</dt><dd><dl class="simple">
<dt>self.pool = await asyncpg.create_pool(</dt><dd><p>self.database_url,
min_size=10,
max_size=20</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>async def execute(self, query, <a href="#id119"><span class="problematic" id="id120">*</span></a>args):</dt><dd><dl class="simple">
<dt>async with self.pool.acquire() as conn:</dt><dd><p>return await conn.execute(query, <a href="#id121"><span class="problematic" id="id122">*</span></a>args)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id123"><span class="problematic" id="id124">``</span></a><a href="#id125"><span class="problematic" id="id126">`</span></a></p>
<p>## Решение проблем</p>
<p>### Платеж не отправляется</p>
<p><strong>Проверьте:</strong>
1. Токен бота действителен
2. Пользователь запустил бота
3. Этап платежа существует
4. ID пользователя правильный</p>
<p><a href="#id127"><span class="problematic" id="id128">``</span></a><a href="#id129"><span class="problematic" id="id130">`</span></a>python
# Отладка отправки платежа
async def debug_send_payment(user_id: int, stage_id: str):</p>
<blockquote>
<div><p># Проверить, существует ли этап
stage = neonpay.get_payment_stage(stage_id)
if not stage:</p>
<blockquote>
<div><p>print(f”Этап {stage_id} не найден”)
return</p>
</div></blockquote>
<p># Проверить, существует ли пользователь
try:</p>
<blockquote>
<div><p>user = await bot.get_chat(user_id)
print(f”Пользователь найден: {user.first_name}”)</p>
</div></blockquote>
<dl class="simple">
<dt>except Exception as e:</dt><dd><p>print(f”Пользователь не найден: {e}”)
return</p>
</dd>
</dl>
<p># Отправить платеж
try:</p>
<blockquote>
<div><p>await neonpay.send_payment(user_id, stage_id)
print(“Платеж отправлен успешно”)</p>
</div></blockquote>
<dl class="simple">
<dt>except Exception as e:</dt><dd><p>print(f”Платеж не удался: {e}”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id131"><span class="problematic" id="id132">``</span></a><a href="#id133"><span class="problematic" id="id134">`</span></a></p>
<p>### Callback платежа не работает</p>
<p><strong>Проверьте:</strong>
1. Декоратор <cite>&#64;neonpay.on_payment</cite> правильно применен
2. Функция асинхронная
3. Бот запущен и получает обновления</p>
<p><a href="#id135"><span class="problematic" id="id136">``</span></a><a href="#id137"><span class="problematic" id="id138">`</span></a>python
# Тест callback платежа
&#64;neonpay.on_payment
async def test_payment_handler(result):</p>
<blockquote>
<div><p>print(f”Callback платежа сработал: {result}”)
# Добавьте точку останова здесь для отладки</p>
</div></blockquote>
<p><a href="#id139"><span class="problematic" id="id140">``</span></a><a href="#id141"><span class="problematic" id="id142">`</span></a></p>
<p>### Бот не отвечает на команды</p>
<p><strong>Проверьте:</strong>
1. Токен бота правильный
2. Бот запущен
3. Команды правильно зарегистрированы
4. Сетевое подключение</p>
<p><a href="#id143"><span class="problematic" id="id144">``</span></a><a href="#id145"><span class="problematic" id="id146">`</span></a>python
# Тест подключения бота
async def test_bot():</p>
<blockquote>
<div><dl class="simple">
<dt>try:</dt><dd><p>me = await bot.get_me()
print(f”Бот работает: {me.first_name}”)</p>
</dd>
<dt>except Exception as e:</dt><dd><p>print(f”Подключение к боту не удалось: {e}”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a></p>
<p>### Проблемы с подключением к базе данных</p>
<p><a href="#id151"><span class="problematic" id="id152">``</span></a><a href="#id153"><span class="problematic" id="id154">`</span></a>python
# Тест подключения к базе данных
async def test_database():</p>
<blockquote>
<div><dl class="simple">
<dt>try:</dt><dd><p>conn = await asyncpg.connect(DATABASE_URL)
result = await conn.fetchval(“SELECT 1”)
print(f”База данных подключена: {result}”)
await conn.close()</p>
</dd>
<dt>except Exception as e:</dt><dd><p>print(f”Подключение к базе данных не удалось: {e}”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id155"><span class="problematic" id="id156">``</span></a><a href="#id157"><span class="problematic" id="id158">`</span></a></p>
<p>## Частые проблемы</p>
<p>### “Этап платежа не найден”</p>
<p>Это происходит, когда вы пытаетесь отправить платеж для несуществующего этапа:</p>
<p><a href="#id159"><span class="problematic" id="id160">``</span></a><a href="#id161"><span class="problematic" id="id162">`</span></a>python
# Проверить доступные этапы
stages = neonpay.list_payment_stages()
print(f”Доступные этапы: {list(stages.keys())}”)</p>
<p># Создать этап, если отсутствует
if “premium” not in stages:</p>
<blockquote>
<div><p>stage = PaymentStage(“Премиум”, “Премиум доступ”, 25)
neonpay.create_payment_stage(“premium”, stage)</p>
</div></blockquote>
<p><a href="#id163"><span class="problematic" id="id164">``</span></a><a href="#id165"><span class="problematic" id="id166">`</span></a></p>
<p>### “Не удалось отправить инвойс”</p>
<p>Это обычно означает:
1. Токен бота недействителен
2. Пользователь не запустил бота
3. ID пользователя неправильный</p>
<p><a href="#id167"><span class="problematic" id="id168">``</span></a><a href="#id169"><span class="problematic" id="id170">`</span></a>python
# Отладка отправки инвойса
async def debug_invoice(user_id: int, stage_id: str):</p>
<blockquote>
<div><dl>
<dt>try:</dt><dd><p># Проверить информацию о боте
me = await bot.get_me()
print(f”Бот: {me.first_name} (&#64;{me.username})”)</p>
<p># Проверить пользователя
user = await bot.get_chat(user_id)
print(f”Пользователь: {user.first_name} (&#64;{user.username})”)</p>
<p># Отправить платеж
await neonpay.send_payment(user_id, stage_id)</p>
</dd>
<dt>except Exception as e:</dt><dd><p>print(f”Ошибка: {e}”)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id171"><span class="problematic" id="id172">``</span></a><a href="#id173"><span class="problematic" id="id174">`</span></a></p>
<p>### “Callback платежа не срабатывает”</p>
<p>Убедитесь, что:
1. Функция декорирована <cite>&#64;neonpay.on_payment</cite>
2. Функция асинхронная
3. Бот получает обновления</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Тест</span> <span class="pre">регистрации</span> <span class="pre">callback</span>
<span class="pre">stats</span> <span class="pre">=</span> <span class="pre">neonpay.get_stats()</span>
<span class="pre">print(f&quot;Callbacks</span> <span class="pre">зарегистрированы:</span> <span class="pre">{stats['registered_callbacks']}&quot;)</span>
<span class="pre">`</span></code></p>
<p>## Получение помощи</p>
<p>### Где можно получить помощь?</p>
<ol class="arabic simple">
<li><p><strong>Документация</strong>: Проверьте папку [examples](../../examples/)</p></li>
<li><p><strong>Сообщество</strong>: Присоединяйтесь к нашему [Telegram сообществу](<a class="reference external" href="https://t.me/neonpay_community">https://t.me/neonpay_community</a>)</p></li>
<li><p><strong>Проблемы</strong>: Откройте issue на [GitHub](<a class="reference external" href="https://github.com/Abbasxan/neonpay/issues">https://github.com/Abbasxan/neonpay/issues</a>)</p></li>
<li><p><strong>Email</strong>: Свяжитесь с поддержкой по [<a class="reference external" href="mailto:support&#37;&#52;&#48;neonpay&#46;com">support<span>&#64;</span>neonpay<span>&#46;</span>com</a>](<a class="reference external" href="mailto:support&#37;&#52;&#48;neonpay&#46;com">mailto:support<span>&#64;</span>neonpay<span>&#46;</span>com</a>)</p></li>
</ol>
<p>### Как сообщить об ошибках?</p>
<p>При сообщении об ошибках, пожалуйста, включите:
1. Версию Python
2. Версию NEONPAY
3. Библиотеку бота и версию
4. Сообщение об ошибке и стек вызовов
5. Шаги для воспроизведения</p>
<p>### Как запросить функции?</p>
<p>Запросы функций приветствуются! Пожалуйста:
1. Проверьте, существует ли функция уже
2. Опишите случай использования
3. Предоставьте пример кода, если возможно
4. Откройте issue на GitHub</p>
<p>—</p>
<p><strong>Все еще есть вопросы? Проверьте папку [examples](../../examples/) или свяжитесь с поддержкой!</strong></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="API.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SECURITY.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, NEONPAY Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>